<div class="container mt-3">
    <h5>Total Results Dispatched To A Facility</h5>
    <div class="row">
        <div class="col-12">
            <table id="dispatched_results_at_molecular_table" class="table table-striped table-bordered" style="width:100%">
            <%if @data[:type] == 'topLevel'%>
                <thead>
                    <tr>
                        <th>Facility To Deliver Results To</th>
                        <th>Total Results Dispatched</th>
                    </tr>
                </thead>
            <%else%>
                <thead>
                    <tr>
                        <th>Tracking Number</th>
                        <th>Facility</th>
                        <th>District</th>
                        <th>Test Type</th>
                        <th>Date Created</th>
                    </tr>
                </thead>
            <%end%>
            </table>
        </div>
    </div>
</div>

<script>
$(document).ready(function () {
    let dataset = JSON.parse('<%=raw(@data.to_json)%>');
    if (dataset.type === 'topLevel'){
        $('#dispatched_results_at_molecular_table').DataTable({
                    data: dataset.orders,
                    "columnDefs": [
                        { className: "openPopup", "targets": [ 0 ] }
                    ],
                    columns: [
                        { data: 'facility',
                            "render": function (data) {
                                let baseUrl = window.location.href;
                                let dataURL = new URL(baseUrl+ `?site_name=${data}`).href
                                return '<a href="'+dataURL+'">'+data+'</a>';
                            } 
                        },
                        { data: 'dispatched_results_at_molecular' }
                        
                    ],
                    destroy: true
            } );
    }else{
        $('#dispatched_results_at_molecular_table').DataTable( {
                    data: dataset.orders,
                    columns: [
                        { data: 'tracking_number'},
                        { data: 'facility' },
                        { data: 'district' },
                        {data: 'test_type'},
                        { data: 'date_created'}
                        
                    ],
                    destroy: true
            } );
    }

});
</script>